<!DOCTYPE html>

<style type="text/css">
  a {
    color: #000;
  }
  #wrapper {
    margin: 0 auto;
    width: 640px;
  }
</style>

<a href="https://github.com/gre/glsl.js"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Fork me on GitHub"></a>


<div id="wrapper">

<h1>Heat map with <a href="http://github.com/gre/glsl.js">glsl.js</a> ...</h1>

<canvas id="game" width="640" height="400"></canvas>

<script id="fragment" type="x-shader/x-fragment">
  precision mediump float;
  uniform vec2 resolution;
  uniform float time;

  #define MAX_POINTS 10

  uniform vec3 points[MAX_POINTS];
  uniform int pointsLength;

  vec3 heat (float value) {
    return (0.5+0.5*smoothstep(0.0, 0.1, value))*vec3(
      smoothstep(0.5, 0.3, value),
      value < 0.3 ? smoothstep(0.0, 0.3, value) : smoothstep(1.0, 0.6, value),
      smoothstep(0.4, 0.6, value)
    );
  }

  void main () {
    vec2 p = gl_FragCoord.xy / resolution.xy;
    float sum = 0.0;
    for (int i=0; i<MAX_POINTS; ++i) { if (i == pointsLength) break;
      vec3 point = points[i];
      sum += smoothstep(0.0, point.z, distance(point.xy, p));
    }
    gl_FragColor = vec4(heat(sum/float(pointsLength)), 1.0);
  }
</script>

<script type="text/javascript" src="../../glsl.js"></script>

<script type="text/javascript">
  if (!Glsl.supported()) alert("WebGL is not supported.");

  function smoothstep (a, b, v) {
    return Math.max(0, Math.min((v-a)/(b-a), 1));
  }

  Glsl({
    canvas: document.getElementById("game"),
    fragment: document.getElementById("fragment").textContent,
    variables: {
      time: 0,
      pointsLength: 0
    },
    init: function () {
      points = new Float32Array(this.defines.MAX_POINTS*3);
      for (var i = 0; i<this.defines.MAX_POINTS; ++i) {
        points[3*i] = 0.5;
        points[3*i+1] = 0.5;
        points[3*i+2] = 0.5;
      }
      this.set("points", points);
      this.set("pointsLength", this.defines.MAX_POINTS);
    },
    update: function (time, delta) {
      var speed = 0.005*delta;
      for (var i = 0; i<this.defines.MAX_POINTS; ++i) {
        points[3*i] = smoothstep(0, 1, points[3*i] + speed*(Math.random()-0.5));
        points[3*i+1] = smoothstep(0, 1, points[3*i+1] + speed*(Math.random()-0.5));
        points[3*i+2] = (2+Math.sin(time/1000))*0.3;
      }
      this.set("points", points);
      this.set("time", time);
    }
  }).start();
</script>

<a href="..">Back to more examples</a>

</div>
